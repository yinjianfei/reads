## 静态库

**静态库的特点：**

1. 使用静态库的时候，会将静态库的信息直接编译到可执行文件中
2. 优点:当静态库被删除，对可执行文件没有影响
3. 缺点:浪费内存空间。如果静态库被修改，可执行程序要重新编译

## 动态库

>加载器在加载动态库时，操作系统会先检查动态库是否因为其它程序已经将这个动态库信息加载到了内存中。如果没有加载到内存中，操作系统会将动态库载入内存，并将它的引用计数设置为1;如果已经加载到内存，仅将动态库的引用计数加1。


## 编译过程和简介

### 名词
**编译:** 把源文件中的源代码翻译成机器语言,保存到目标文的过程
**编译单元:** 每个cpp文件就是一个编译单元,当一个c或者cpp文件被编译时,预处器首先递归包含头文件,形成一个含有所有必须信息的单个源文件,这个源文件就是编译单元
**目标文件:** 编译后生成的文件,以机器码的形式包含了编译单元的所有函数和数据,导出符号表,未解决符号表,地址重定向表等.

目标文件类型:
1. 可重定位文件(.o .obj文件): 其中包含有适用于其它目标文件链接来创建一个可执行的或者共享的目标文件的代码和数据
2. 共享目标文件(库文件): 静态库文件 动态库文件
3. 可执行文件: 一个可以被操作系统执行的文件

.o文件在编译后就能获得,但是库文件,可执行文件都需要在链接后才能获得
![编译过程](assets/markdown-img-paste-20190808195906959.png)


### 过程
>作用: 编译是读取源文件程序,对之进行词法和语法分析,将高级语言指令转换为功能高效的汇编代码,然后在转换为机器代码,生成目标文件

1. 编译

  - 预处理阶段
    - 宏解析#define
    - 条件编译如:#ifdef #ifndef #else 等
    - 头文件包含 #include
    - 特殊符号
      - LINE标示被解释为当前行号(十进制)
      - FILE标示则被解释为当前被便衣的c源程序的名称, 预编译程序对与在源程序中出现的这些穿进行替换
  - 编译,优化阶段 生成汇编代码
    - 针对代码优化,不依赖具体计算机
    - 针对计算机系统优化
  - 汇编
    - 把汇编语言代码翻译成机器指令
  - 三张表 .o文件至少要提供三张表
    - 导出符号表: 即该目标文件可以提供的符号及地址
    - 未解决符号表: 即找不到地址的符号列表,告诉链接器这些符号没有找到地址
    - 地址重定向表: 提供了本编译单元所有对自身地址引用的记录

2. 链接
>链接程序主要工作就是将有关的目标文件(库文件,.o文件)彼此链接,也就是将在一个文件中引用的符号同该符号在另外一个文件中的定义连接起来,使得所有的这些目标文件成文一个能够被操作系统执行的同意整体

  - 具体工作：
>当链接器进行链接的时候，首先决定各个目标文件在最终可执行文件里的位置。然后访问所有目标文件的地址重定向表，对其中记录的地址进行重定向（加上一个偏移量，即该编译单元在可执行文件上的起始地址）。然后遍历所有目标文件的未解决符号表，并且在所有的导出符号表里查找匹配的符号，并在未解决符号表中所记录的位置上填写实现地址。最后把所有的目标文件的内容写在各自的位置上，再作一些另的工作，就生成一个可执行文件。
  - 链接方式
    - 静态链接：函数的代码将从其所在地静态链接库中被拷贝到最终的可执行程序中。这样该程序在被执行时这些代码将被装入到该进程的虚拟地址空间中。
    - 动态链接：函数的代码被放到称作是动态链接库或共享对象的某个目标文件中。链接程序此时所作的只是在最终的可执行程序中.记录下共享对象的名字以及其它少量的登记信息。在此可执行文件被执行时，动态链接库的全部内容将被映射到运行时相应进程的虚地址空间。动态链接程序将根据可执行程序中记录的信息找到相应的函数代码。
